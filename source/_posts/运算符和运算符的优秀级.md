---
title: 运算符和运算符的优先级
date: 2021-04-11 12:09:48
summary: 你不能只问顾客要什么，然后想法子给他们做什么。等你做出来，他们已经另有新欢了。
categories: C#
tags:
	- C#
---

## C 运算符的优先级和关联性

| 符号 1                                                  | 操作类型         | 结合性   |
| :------------------------------------------------------ | :--------------- | :------- |
| `[` `]` `(` `)` `.` `->` `++` `--`（后缀）              | 表达式           | 从左到右 |
| **`sizeof`** `&` `*` `+` `-` `~` `!` `++` `--`（前缀）  | 一元             | 从右到左 |
| *typecasts*                                             | 一元             | 从右到左 |
| `*` `/` `%`                                             | 乘法             | 从左到右 |
| `+` `-`                                                 | 加法             | 从左到右 |
| `<<` `>>`                                               | 按位移动         | 从左到右 |
| `<` `>` `<=` `>=`                                       | 关系             | 从左到右 |
| `==` `!=`                                               | 相等             | 从左到右 |
| `&`                                                     | 按位“与”         | 从左到右 |
| `^`                                                     | 按位“异或”       | 从左到右 |
| `|`                                                     | 按位“与或”       | 从左到右 |
| `&&`                                                    | 逻辑“与”         | 从左到右 |
| `||`                                                    | 逻辑“或”         | 从左到右 |
| `? :`                                                   | 条件表达式       | 从右到左 |
| `=` `*=` `/=` `%=` `+=` `-=` `<<=` `>>=` `&=` `^=` `|=` | 简单和复合赋值 2 | 从右到左 |
| `,`                                                     | 顺序计算         | 从左到右 |

注：

> 1 运算符按优先级的降序顺序列出。 如果多个运算符出现在同一行或一个组中，则它们具有相同的优先级。
>
> 2 所有简单的和复合的赋值运算符都有相同的优先级。

## 优先级比较：

[![cwtE0U.png](https://z3.ax1x.com/2021/04/11/cwtE0U.png)](https://imgtu.com/i/cwtE0U)

## 示例

以下列表显示编译器如何自动绑定多个示例表达式：

| 表达式          | 自动绑定          |
| :-------------- | :---------------- |
| `a & b || c`    | `(a & b) || c`    |
| `a = b || c`    | `a = (b || c)`    |
| `q && r || s--` | `(q && r) || s--` |

在第一个表达式中，按位“与”运算符 (`&`) 的优先级高于逻辑“或”运算符 (`||`) 的优先级，因此，`a & b` 构成了逻辑“或”运算的第一操作数。

在第二个表达式中，逻辑“或”运算符 (`||`) 的优先级高于简单赋值运算符 (`=`) 的优先级，因此，`b || c` 在赋值中分组为右操作数。 请注意，赋给 `a` 的值为 0 或 1。

第三个表达式显示可能会生成意外结果的格式正确的表达式。 逻辑“与”运算符 (`&&`) 的优先级高于逻辑“或”运算符 (`||`) 的优先级，因此，将 `q && r` 分组为操作数。 由于逻辑运算符确保按从左到右的顺序计算操作数，因此 `q && r` 先于 `s--` 被计算。 但是，如果 `q && r` 计算的结果为非零值，则不计算 `s--`，并且 `s` 不会减少。 如果 `s` 未减少会导致程序出现问题，则 `s--` 应显示为表达式的第一操作数，或者在单独的运算中应减少 `s`。

以下表达式是非法的并会在编译时生成诊断消息：

| 非法表达式                | 默认分组                       |
| :------------------------ | :----------------------------- |
| `p == 0 ? p += 1: p += 2` | `( p == 0 ? p += 1 : p ) += 2` |

在此表达式中，相等运算符 (`==`) 的优先级最高，因此，将 `p == 0` 分组为操作数。 条件表达式运算符 (`? :`) 具有下一个最高级别的优先级。 其第一操作数是 `p == 0`，第二操作数是 `p += 1`。 但是，条件表达式运算符的最后一个操作数被视为 `p` 而不是 `p += 2`，因为与复合赋值运算符相比，`p` 的匹配项将更紧密地绑定到条件表达式运算符。 由于 `+= 2` 没有左操作数，因此发生语法错误。 您应使用括号以防止此类错误发生并生成可读性更高的代码。 例如，可以按如下所示使用括号来更正和阐明前面的示例：

```
( p == 0 ) ? ( p += 1 ) : ( p += 2 )
```